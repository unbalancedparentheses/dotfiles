#!/bin/sh
# dwm session startup

# Merge Xresources
xrdb -merge ~/.Xresources

# Disable the bell
xset -b

# Keyboard repeat rate (delay, rate)
xset r rate 200 50

# Find dotfiles directory
DOTFILES="$HOME/Desktop/projects/dotfiles"
[ ! -d "$DOTFILES" ] && DOTFILES="$HOME/dotfiles"
[ ! -d "$DOTFILES" ] && DOTFILES="$HOME/.dotfiles"

# Set wallpaper
if command -v feh >/dev/null 2>&1; then
    for dir in "$DOTFILES/wallpapers" "$HOME/.config/wallpapers" "$HOME/Pictures/Wallpapers"; do
        if [ -d "$dir" ]; then
            feh --bg-fill --randomize "$dir"/* &
            break
        fi
    done
fi

# Compositor (transparency, shadows, blur)
if command -v picom >/dev/null 2>&1; then
    picom -b &
fi

# SSH agent
eval $(ssh-agent)
ssh-add < /dev/null 2>/dev/null

# Screen locker (5 min timeout)
if command -v slock >/dev/null 2>&1; then
    xautolock -time 5 -locker slock &
fi

# Automount USB drives
if command -v udiskie >/dev/null 2>&1; then
    udiskie &
fi

# Night light - uses LOCATION env var or defaults to Buenos Aires
# Set LOCATION=lat:lon in your shell config to override
REDSHIFT_LOC="${LOCATION:--34.60:-58.38}"
if command -v redshift >/dev/null 2>&1; then
    redshift -l "$REDSHIFT_LOC" &
fi

# Notifications
if command -v dunst >/dev/null 2>&1; then
    dunst &
fi

# Network manager applet
if command -v nm-applet >/dev/null 2>&1; then
    nm-applet &
fi

# Clipboard sync (primary <-> clipboard)
if command -v autocutsel >/dev/null 2>&1; then
    autocutsel -fork -selection CLIPBOARD
    autocutsel -fork -selection PRIMARY
fi

# Audio systray
if command -v pasystray >/dev/null 2>&1; then
    pasystray &
fi

# Battery indicator
if command -v cbatticon >/dev/null 2>&1; then
    cbatticon &
fi

# Status bar
if command -v slstatus >/dev/null 2>&1; then
    slstatus &
fi

# Start dwm
exec dwm
